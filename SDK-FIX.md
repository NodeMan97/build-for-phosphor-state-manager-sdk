# Work around for SDK build failures

This document is intended to provide steps to build phosphor-state-manager for
the SDK's "Hello World" example in Openbmc/docs/development. An issue was brought up
here "https://github.com/openbmc/docs/issues/76" where the dependency "cereal" failed
to build. This is most likely due to a broken link in the project's dependency chain
causing the "boost_serialization" autogenerated cmake files not to exist.
The reproducable output is included in the build's meson-logs.txt included in this
repository.

The fix was to manually place the would be generated cmake files into the
'usr/lib/cmake' directory in the SDK's filesystem. Therefore allowing
the cereal dependency to build.
After the initial problem was solved the sdk failed to complete a ninja
build of application. Due to another dependency "sdeventplus" not being
able to locate the "function2/function2.hpp" header. The solution for this
was to add a wrap for the "function2" dependency in the subprojects folder
of phosphor-state-manager.
Once these steps are completed the SDK's hello-world example along with it's
precursor step, cross compiling phosphor-state-manager for the SDK, worked as
expected.

# Step one: Add Boost files

Go to the cmake directory generated during the sdk installation step.
and create a boost_serialization directory.
```
   cd ~/sdk/romulus-2022-08-02/sysroots/arm1176jzs-openbmc-linux-gnueabi/usr/lib/cmake
```

Inject the cmake files included in this repo for boost_serialization.
```
   cp -r build-for-phosphor-state-manager-sdk/boost_serialization-1.79.0 boost_serialization-1.79.0
   chmod +rwx boost_serialization-1.79.0
```

Once the boost files have been added it is possible to simply build from this repo to complete
the "Hello World" SDK example as supposed to following the preceding steps.

# Step two: Add function2 wrap file
Go to phosphor-state-manager's subprojects directory and add the function2.wrap file.
```
   cd ~/sdk/phosphor-state-manager/subprojects
   cp build-for-phosphor-state-manager-sdk/subprojects/function2.wrap function2.wrap
```

# Step three: Update meson build file

Remove the existing meson.build file and add the one from this repo.

```
  cd ~/sdk/phosphor-state-manager
  rm -rf meson.build
  cp build-for-phosphor-state-manager-sdk/meson.build meson.build
```
